<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>çµé­”äºº</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&family=Noto+Serif+TC:wght@700&display=swap');
        body { 
            font-family: 'Noto Sans TC', sans-serif; 
            touch-action: manipulation;
            background-color: #0f0518; /* æ·±é‚ƒç´«é»‘ */
            color: #e2e8f0;
        }
        .font-serif { font-family: 'Noto Serif TC', serif; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .card-active:active { transform: scale(0.95); }
        .modal-enter { animation: fadeIn 0.2s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        
        /* æ—é–€å·¦é“é¢¨æ ¼ç™¼å…‰ */
        @keyframes wicked-glow {
            0%, 100% { border-color: rgba(168, 85, 247, 0.6); box-shadow: 0 0 5px rgba(168, 85, 247, 0.3); }
            50% { border-color: rgba(236, 72, 153, 1); box-shadow: 0 0 20px rgba(236, 72, 153, 0.6); transform: scale(1.02); }
        }
        .target-glow {
            animation: wicked-glow 1.5s infinite ease-in-out;
            z-index: 20 !important;
        }

        /* å±æ¯’è­¦å‘Šå‹•ç•« - ç¶ è‰²ç³» */
        @keyframes poison-pulse {
            0%, 100% { box-shadow: 0 0 5px rgba(20, 184, 166, 0.5); border-color: rgba(45, 212, 191, 0.6); }
            50% { box-shadow: 0 0 20px rgba(52, 211, 153, 0.9); border-color: rgba(110, 231, 183, 1); }
        }
        .curse-warning {
            animation: poison-pulse 1s infinite;
        }

        /* ç¡¬å¹£æ¨£å¼ */
        .coin-shadow { box-shadow: 1px 1px 2px rgba(0,0,0,0.6), inset 1px 1px 2px rgba(255,255,255,0.4); }

        /* æŒ‰éˆ•æµå…‰ç‰¹æ•ˆ */
        @keyframes shine {
            100% { left: 125%; }
        }
        .btn-shine::after {
            content: '';
            position: absolute;
            top: 0;
            left: -75%;
            width: 50%;
            height: 100%;
            background: linear-gradient(to right, rgba(255,255,255,0) 0%, rgba(255,255,255,0.3) 100%);
            transform: skewX(-25deg);
            animation: shine 3s infinite;
        }
    </style>
</head>
<body class="min-h-[100dvh] flex flex-col">
    <div id="root" class="flex-1 flex flex-col">
        <div class="flex items-center justify-center h-screen text-purple-300 animate-pulse font-serif">
            çµé­”äººé›†çµä¸­ï¼Œæº–å‚™æ‰å¦–...
        </div>
    </div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- åœ–æ¨™å…ƒä»¶ ---
        const Icons = {
            Skull: ({className}) => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="9" cy="12" r="1"/><circle cx="15" cy="12" r="1"/><path d="M8 20v2h8v-2"/><path d="M12.5 17l.5-2 .5 2h2l.5-2 .5 2"/><path d="M16 20a2 2 0 0 0 1.56-3.25 8 8 0 1 0-11.12 0A2 2 0 0 0 8 20"/></svg>,
            Poison: ({className}) => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" className={className}><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8 0-2.66 1.33-5.02 3.37-6.52.22-.16.51-.13.7.06L9.6 7.42c.18.19.16.5-.03.68C8.54 9.07 7.91 10.45 7.91 12c0 2.25 1.84 4.09 4.09 4.09 1.13 0 2.15-.46 2.89-1.2.19-.19.49-.18.68 0l1.46 1.46c.19.19.19.5 0 .68-1.47 1.48-3.51 2.39-5.74 2.39-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"/><circle cx="9" cy="10" r="1.5"/><circle cx="15" cy="10" r="1.5"/></svg>,
            Heart: ({className}) => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" className={className}><path d="M11.645 20.91l-.007-.003-.022-.012a15.247 15.247 0 01-.383-.218 25.18 25.18 0 01-4.244-3.17C4.688 15.36 2.25 12.174 2.25 8.25 2.25 5.322 4.714 3 7.688 3A5.5 5.5 0 0112 5.052 5.5 5.5 0 0116.313 3c2.973 0 5.437 2.322 5.437 5.25 0 3.925-2.438 7.111-4.739 9.256a25.175 25.175 0 01-4.244 3.17 15.247 15.247 0 01-.383.219l-.022.012-.007-.004-.003-.001a.752.752 0 01-.704 0l-.003-.001z" /></svg>,
            ChevronDown: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="6 9 12 15 18 9"/></svg>,
            ChevronUp: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="18 15 12 9 6 15"/></svg>,
            Refresh: () => <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></svg>,
            X: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>,
            Book: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></svg>,
            Plus: () => <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>,
            Minus: () => <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round"><line x1="5" y1="12" x2="19" y2="12"/></svg>,
            Fire: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.1.2-2.2.6-3.3.3-1.3 1.3-2.5 2.4-3.2 0 1.6.5 3.3 1.5 4.5z"/></svg>,
            Tao: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2a10 10 0 1 0 10 10A10 10 0 0 0 12 2zm0 18a8 8 0 1 1 8-8 8 8 0 0 1-8 8z"/><path d="M12 4a8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8 8 8 0 0 0-8-8zm0 14a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6zm0-10a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4z"/><circle cx="12" cy="14" r="1"/><circle cx="12" cy="10" r="1"/></svg>
        };

        // --- ç¡¬å¹£é¡¯ç¤ºçµ„ä»¶ ---
        const CoinIcon = ({ value, className }) => {
            const isGold = value === 2;
            const bgClass = isGold 
                ? 'bg-gradient-to-br from-yellow-300 via-yellow-500 to-yellow-600 border-yellow-200 text-yellow-50 ring-1 ring-yellow-800' 
                : 'bg-gradient-to-br from-slate-300 via-slate-400 to-slate-500 border-slate-200 text-slate-50 ring-1 ring-slate-700';
            
            return (
                <div className={`
                    rounded-full flex items-center justify-center font-black border-2 select-none coin-shadow
                    w-5 h-5 text-[10px] leading-none
                    ${bgClass} ${className}
                `}>
                    <span className="drop-shadow-md transform -translate-y-[0.5px]">{value}</span>
                </div>
            );
        }

        const PLAYER_COUNT = 4;
        const MONSTER_COUNT = 8; 
        const MAX_CARDS = 8;     
        const MAX_ROUNDS = 7;    
        const INITIAL_COINS1 = 5; 
        const INITIAL_COINS2 = 3; 
        const PENALTY_PER_CURSE = 10; 
        
        const NAME_CHARS = ['é™°', 'ç…', 'é‚ª', 'éª¨', 'èµ¤', 'è¡€', 'æ®˜', 'å¹½', 'æ¯’', 'ç‹‚', 'å¢¨', 'å¯’', 'è€', 'å­¤', 'é¬¼'];
        const PLAYER_NAMES = ["é“å‹ç”²", "é“å‹ä¹™", "é“å‹ä¸™"]; 

        const generateMonsterName = () => {
            const types = ["å¦–ç¸", "é­”é ­", "é™°é­‚", "å±å‚€", "é‚ªéˆ"];
            const prefix = NAME_CHARS[Math.floor(Math.random() * NAME_CHARS.length)] + NAME_CHARS[Math.floor(Math.random() * NAME_CHARS.length)];
            return prefix + types[Math.floor(Math.random() * types.length)];
        };

        const getRandomBg = () => {
            const bgs = [
                "bg-gradient-to-b from-slate-900 to-black",
                "bg-gradient-to-b from-violet-950 to-black",
                "bg-gradient-to-b from-fuchsia-950 to-black",
                "bg-gradient-to-b from-rose-950 to-black",
            ];
            return bgs[Math.floor(Math.random() * bgs.length)];
        };

        // --- æ³•å¯¶è¨­å®š ---
        const getCardConfig = (speed) => {
            if (speed <= 2) return { power: 2, emoji: "ğŸ“œ", name: "é®é¬¼ç¬¦", color: "bg-zinc-800/80", border: "border-zinc-500", text: "text-zinc-300" };
            if (speed <= 4) return { power: 3, emoji: "ğŸ—¡ï¸", name: "æ¡ƒæœ¨åŠ", color: "bg-red-900/80", border: "border-red-600", text: "text-red-200" };
            if (speed <= 6) return { power: 4, emoji: "ğŸ›ï¸", name: "ä¸‰æ¸…éˆ´", color: "bg-amber-800/80", border: "border-amber-500", text: "text-amber-100" };
            return { power: 5, emoji: "âš¡", name: "æŒå¿ƒé›·", color: "bg-purple-900/80", border: "border-purple-500", text: "text-purple-200" };
        };

        // --- è¦å‰‡è¦–çª— ---
        const RulesModal = ({ onClose }) => (
            <div className="fixed inset-0 bg-black/95 z-50 flex items-center justify-center p-4 modal-enter" onClick={onClose}>
                <div className="bg-slate-900 rounded-xl border border-purple-600/50 w-full max-w-lg p-5 relative shadow-2xl shadow-purple-900/20" onClick={e => e.stopPropagation()}>
                    <button onClick={onClose} className="absolute top-3 right-3 text-slate-400 hover:text-white">
                        <Icons.X />
                    </button>
                    
                    <h2 className="text-xl font-black text-purple-400 mb-4 flex items-center gap-2 border-b border-purple-800 pb-3 font-serif">
                        <Icons.Book /> çµé­”äººå®ˆå‰‡
                    </h2>

                    <div className="space-y-6 text-sm text-slate-300 overflow-y-auto max-h-[65vh] pr-2 custom-scrollbar">
                        
                        <section>
                            <h3 className="text-white font-bold text-base mb-1 font-serif">ğŸ”® çµé­”äºº</h3>
                            <div className="leading-relaxed text-slate-400 text-sm">
                                å¾ç­‰æµªè·¡å¤©æ¶¯ï¼Œä»¥çµé­”æ‰å¦–ç‚ºæ¥­ã€‚<br/>
                                å¦–é­”é«”å…§è˜Šå«é«˜éšä¿®ç‚º <span className="inline-flex align-middle mx-0.5"><CoinIcon value={2} /></span> èˆ‡ä½éšä¿®ç‚º <span className="inline-flex align-middle mx-0.5"><CoinIcon value={1} /></span> ï¼Œçš†å¯ç‚ºçµé­”äººæ‰€ç”¨ã€‚<br/>
                                ä½†é ˆè¬¹è¨˜é™¤æƒ¡å‹™ç›¡ï¼Œè‹¥å¤§æ„è€Œæ²¾æŸ“ã€Œå±æ¯’ã€ï¼Œå°‡æœƒæè€—è‡ªèº«ä¿®ç‚ºã€‚
                            </div>
                        </section>

                        <section>
                            <h3 className="text-white font-bold text-base mb-2 font-serif">ğŸ”ª çµé­”æµç¨‹</h3>
                            <div className="space-y-3 pl-2 border-l-2 border-purple-700">
                                <div>
                                    <span className="text-purple-300 font-bold block">1. ç‡ƒç‡’ä¿®ç‚º (Enhance)</span>
                                    <p className="text-xs mt-1">
                                        é»é¸ä»‹é¢ä¾†ç‡ƒç‡’ä»»æ„ä¿®ç‚º (<span className="inline-flex align-middle mx-0.5"><CoinIcon value={2} /></span>/<span className="inline-flex align-middle mx-0.5"><CoinIcon value={1} /></span>) ä»¥åŠ æŒæ³•å¯¶ã€‚<br/>
                                        æ¶ˆè€— N å¹´ä¿®ç‚º = æœ¬å›åˆæ³•å¯¶ +N å¨åŠ›ã€‚<br/>
                                    </p>
                                </div>
                                <div>
                                    <span className="text-purple-300 font-bold block">2. ç¥­å‡ºæ³•å¯¶ (Select)</span>
                                    <p className="text-xs mt-1">
                                        é»é¸é€™å›åˆå‡ºæ‰‹æ–¹å¼ (SPD ä»£è¡¨é€Ÿåº¦ï¼Œæ•¸å­—è¶Šå°ã€å‡ºæ‰‹é€Ÿåº¦è¶Šå¿«)ã€‚<br/>
                                    </p>
                                </div>
                                <div>
                                    <span className="text-purple-300 font-bold block">3. çµæ®ºå¦–é­” (Resolve)</span>
                                    <div className="text-xs mt-1 text-slate-300">
                                        å¤§å®¶åŒæ™‚å…¬é–‹æ³•å¯¶èˆ‡å…¶åŠ æŒæ•¸å€¼ï¼Œé€Ÿåº¦å¿«è€…å…ˆæ‰‹ã€‚<br/>
                                        è‹¥é€Ÿåº¦ç›¸åŒï¼Œå‰‡åŒæ™‚å‡ºæ‰‹ï¼Œå‚·å®³ç–ŠåŠ ã€‚<br/>
                                        è‹¥å¦–é­”è¢«æ“Šæ®º(ğŸ©¸â‰¤0)ï¼Œå‰‡æœ€å¾Œé€ æˆå‚·å®³çš„çµé­”äºº(å€‘)æœƒå‡åˆ†è©²å¦–é­”æŒæœ‰çš„é«˜/ä½éšä¿®ç‚º<span className="inline-flex align-middle mx-0.5"><CoinIcon value={2} /></span>/<span className="inline-flex align-middle mx-0.5"><CoinIcon value={1} /></span>ï¼Œé¤˜æ•¸ä½µå…¥ä¸‹ä¸€éš»å¦–é­”ã€‚<br/>
                                        è€Œè©²å›åˆå°šæœªå‡ºæ‰‹çš„é“å‹ï¼Œå°‡æ”»æ“Š<strong>ä¸‹ä¸€éš»å¦–é­”</strong>ã€‚<br/>
                                    </div>
                                </div>
                            </div>
                        </section>

                        <section className="bg-emerald-950/30 p-3 rounded border border-emerald-500/30">
                            <h3 className="text-emerald-400 font-bold text-base mb-2 flex items-center gap-1 font-serif">
                                <Icons.Poison className="w-4 h-4" /> å±æ¯’
                            </h3>
                            <ul className="list-disc list-inside text-xs space-y-1 text-emerald-200/80">
                                <li>
                                    å›åˆçµæŸæ™‚ï¼Œè‹¥æœ‰å¦–é­”<strong className="text-white bg-emerald-800 px-1 rounded">å—å‚·æœªæ­»</strong> (è¢«æ¿€æ€’)ã€‚
                                </li>
                                <li>
                                    è©²å›åˆ<strong>æœ€å¾Œå‡ºæ‰‹æ”»æ“Šå®ƒ</strong>çš„çµé­”äºº(å€‘)ï¼Œå°‡è¢«å±æ¯’æ„ŸæŸ“ï¼Œèº«ä¸­ 1 é»ã€å±æ¯’ã€‘ã€‚
                                </li>
                            </ul>
                        </section>

                        <section className="bg-slate-800/50 p-3 rounded">
                            <h3 className="text-amber-500 font-bold text-base mb-1 font-serif">ğŸ† çµç®—</h3>
                            <div className="space-y-2">
                                <p className="text-xs text-white font-bold bg-slate-700/50 px-2 py-1 rounded inline-block">
                                    ğŸ›‘ çµæŸæ¢ä»¶ï¼šç•¶ <span className="text-amber-400">ç¬¬ 7 å›åˆçµæŸ</span> æˆ– <span className="text-amber-400">å¦–é­”å…¨æ»…</span>ã€‚
                                </p>
                                <ol className="list-decimal list-inside text-xs space-y-2 pt-1">
                                    <li className="text-purple-300">
                                        <strong>åŒ–è§£å±æ¯’ï¼š</strong>æ¯æ²¾æŸ“ 1 é»ã€å±æ¯’ã€‘ï¼Œçµç®—æ™‚ä¿®ç‚ºæ¸›å°‘ 10 å¹´ã€‚
                                    </li>
                                    <li className="text-amber-300">
                                        <strong>æ±ºå®šå‹è² ï¼š</strong>æ‰£é™¤å±æ¯’æè€—å¾Œï¼Œä¿®ç‚ºæœ€å¤šè€…å‹åˆ©ã€‚
                                    </li>
                                </ol>
                            </div>
                        </section>

                    </div>

                    <div className="mt-4 pt-3 border-t border-slate-800 flex justify-end">
                        <button onClick={onClose} className="px-6 py-2 bg-purple-700 hover:bg-purple-600 text-white font-bold rounded shadow transition-colors font-serif border border-purple-500">
                            è²§é“æ˜ç™½
                        </button>
                    </div>
                </div>
            </div>
        );

        // --- æ„Ÿè¬è¦–çª— ---
        const GameEndModal = ({ players, onRestart, onClose }) => {
            const processedPlayers = players.map(p => {
                const rawScore = p.coins1 * 1 + p.coins2 * 2;
                const penalty = p.curseCount * PENALTY_PER_CURSE;
                const finalScore = rawScore - penalty;
                
                return {
                    ...p,
                    rawScore,
                    penalty,
                    finalScore,
                };
            });

            processedPlayers.sort((a, b) => b.finalScore - a.finalScore);
            const winner = processedPlayers[0];

            return (
                <div className="fixed inset-0 bg-black/95 z-50 flex items-center justify-center p-4 modal-enter">
                    <div className="bg-slate-900 rounded-xl border-2 border-purple-600 w-full max-w-sm p-6 relative shadow-2xl shadow-purple-900/50 flex flex-col items-center text-center">
                        <button onClick={onClose} className="absolute top-3 right-3 text-slate-500 hover:text-white transition-colors">
                            <Icons.X />
                        </button>
                        
                        <div className="text-5xl mb-4 animate-bounce">
                            {winner?.id === 0 ? 'ğŸ§˜â€â™‚ï¸' : 'â˜¯ï¸'}
                        </div>
                        <h2 className="text-2xl font-black text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-amber-400 mb-1 font-serif">æœ€çµ‚çµç®—</h2>
                        <p className="text-xs text-slate-400 mb-4">
                            æ„Ÿè¬æ‚¨æ’¥å†—åƒèˆ‡éŠæˆ²æ¸¬è©¦ï¼
                        </p>
                        
                        <div className="w-full bg-black/40 rounded-lg p-3 mb-6 border border-slate-800 max-h-[50vh] overflow-y-auto">
                            <h3 className="text-sm font-bold text-slate-300 mb-2 border-b border-slate-700 pb-1 font-serif">æœ€çµ‚ä¿®ç‚ºæ’è¡Œ</h3>
                            <div className="space-y-2">
                                {processedPlayers.map((p, index) => {
                                    const isWinner = index === 0;
                                    return (
                                        <div key={p.id} className={`flex flex-col border-b border-slate-800/50 last:border-0 pb-1`}>
                                            <div className="flex justify-between items-center text-sm font-bold">
                                                <div className="flex items-center gap-2">
                                                    <span className={`w-5 h-5 flex items-center justify-center rounded-full text-xs ${isWinner ? 'bg-amber-500 text-black' : 'bg-slate-700 text-slate-300'}`}>
                                                        {index + 1}
                                                    </span>
                                                    <span className={`${isWinner ? 'text-amber-400' : 'text-slate-300'}`}>
                                                        {p.name}
                                                    </span>
                                                </div>
                                                <div className="flex items-center gap-1.5">
                                                    <span className="text-slate-400 text-xs">{p.rawScore}</span>
                                                    <span className="text-red-500 text-xs">-</span>
                                                    <span className="text-red-400 text-xs font-mono">{p.penalty}</span>
                                                    <span className="text-slate-500 text-xs">=</span>
                                                    <span className={`font-mono text-lg ${isWinner ? 'text-amber-400' : p.finalScore < 0 ? 'text-red-500' : 'text-slate-200'}`}>
                                                        {p.finalScore}
                                                    </span>
                                                    <span className="text-[10px] text-slate-500">å¹´</span>
                                                </div>
                                            </div>
                                            <div className="flex justify-end gap-3 text-[10px] text-slate-500 mt-0.5">
                                                <span className={`${p.curseCount > 0 ? 'text-emerald-400' : ''} flex items-center gap-0.5`}>
                                                    <Icons.Poison className="w-3 h-3 inline" /> å±æ¯’: {p.curseCount} 
                                                    {p.curseCount > 0 && <span className="opacity-70">(-{p.penalty})</span>}
                                                </span>
                                            </div>
                                        </div>
                                    );
                                })}
                            </div>
                        </div>

                        <button 
                            onClick={onRestart} 
                            className="w-full bg-gradient-to-r from-purple-800 to-purple-600 hover:from-purple-700 hover:to-purple-500 text-white font-bold py-3 rounded-lg shadow-lg flex items-center justify-center gap-2 transition-all active:scale-95 border border-purple-400/30 font-serif"
                        >
                            <Icons.Refresh /> é‡æ–°é–‹å§‹
                        </button>
                    </div>
                </div>
            );
        };

        // --- é¡¯ç¤ºçµ„ä»¶ (ä¿®ç‚º/å±æ¯’) ---
        const CultivationDisplay = ({ coins2, coins1, curseCount, compact = false }) => (
            <div className={`flex items-center gap-2 ${compact ? 'scale-90 origin-left' : ''}`}>
                <div className="flex items-center gap-1.5">
                    {coins2 > 0 && <div className="flex items-center -space-x-2"><CoinIcon value={2} className="z-10" /><span className="text-amber-400 font-bold text-xs ml-1.5">x{coins2}</span></div>}
                    {coins1 > 0 && <div className="flex items-center -space-x-2 ml-1"><CoinIcon value={1} className="z-10" /><span className="text-slate-300 font-bold text-xs ml-1.5">x{coins1}</span></div>}
                </div>
                {curseCount > 0 && (
                    <div className="flex items-center gap-0.5 ml-2 bg-emerald-950/50 px-1.5 py-0.5 rounded border border-emerald-500/50" title={`å±æ¯’æ•¸: ${curseCount}`}>
                        <Icons.Poison className="w-3.5 h-3.5 text-emerald-400" />
                        <span className="text-emerald-300 font-bold text-xs">x{curseCount}</span>
                    </div>
                )}
            </div>
        );

        // --- æ‰‹ç‰Œè¿½è¹¤å™¨ ---
        const HandTracker = ({ hand, usedCards }) => {
            const allCards = Array.from({length: MAX_CARDS}, (_, i) => i + 1);
            return (
                <div className="flex justify-between w-full max-w-[150px] mt-1 gap-0.5">
                    {allCards.map(num => {
                        const isAvailable = !usedCards.includes(num);
                        return (
                            <span key={num} className={`
                                text-[9px] w-3.5 h-4 flex items-center justify-center rounded-sm leading-none font-mono transition-all duration-300 border
                                ${isAvailable 
                                    ? 'text-slate-200 bg-slate-700 border-slate-500 shadow-sm font-bold' 
                                    : 'text-slate-700 bg-slate-900/30 border-slate-800 decoration-slate-600 line-through opacity-50' 
                                }
                            `}>
                                {num}
                            </span>
                        );
                    })}
                </div>
            )
        };

        const PlayerStatusBoard = ({ players }) => (
            <div className="grid grid-cols-2 gap-2 bg-slate-900 p-2 shadow-md z-20 border-b border-slate-800">
                {players.map(p => {
                    const currentScore = p.coins1 * 1 + p.coins2 * 2;
                    return (
                        <div key={p.id} className={`flex flex-col p-2 rounded-lg border transition-colors duration-300 ${p.id === 0 ? 'bg-purple-900/20 border-amber-500/30' : 'bg-slate-800/30 border-slate-700/50'}`}>
                            <div className="flex justify-between items-center mb-1">
                                <span className={`text-xs font-bold font-serif ${p.id === 0 ? 'text-amber-300' : 'text-slate-400'}`}>
                                    {p.id === 0 ? 'æœ¬åº§ (æˆ‘)' : p.name}
                                </span>
                                <div className="flex items-center">
                                    <span className="font-bold font-mono text-sm text-amber-100 drop-shadow-sm">{currentScore}å¹´</span>
                                </div>
                            </div>
                            <div className="mb-1">
                                <CultivationDisplay coins2={p.coins2} coins1={p.coins1} curseCount={p.curseCount} compact={true} />
                            </div>
                            <HandTracker hand={p.hand} usedCards={p.usedCards} />
                        </div>
                    );
                })}
            </div>
        );

        const MonsterCard = ({ monster, isTarget }) => {
            if (!monster) return <div className="w-24 h-40 border-2 border-dashed border-slate-800/50 rounded-lg flex items-center justify-center text-slate-600 text-xs font-serif">é­‚é£›é­„æ•£</div>;
            
            return (
                <div className={`
                    w-24 h-40 flex-shrink-0 flex flex-col rounded-lg border-2 relative transition-all duration-300 overflow-hidden shadow-xl
                    ${monster.bg}
                    ${isTarget ? 'border-amber-500 scale-100 z-10 target-glow' : 'border-slate-800 opacity-60 scale-95'}
                `}>
                    <div className="px-2 pt-1 flex justify-between items-center z-10 bg-black/40">
                        <span className={`text-[11px] font-black tracking-widest text-red-100 font-serif drop-shadow`}>{monster.name}</span>
                        {isTarget && <span className={`text-[8px] px-1 rounded-sm font-bold shadow-sm bg-purple-800 text-purple-100 animate-pulse`}>å‡ºæ²’</span>}
                    </div>
                    
                    <div className="flex-1 flex flex-col items-center justify-center relative z-10 pb-2">
                        <div className={`flex flex-col items-center transition-transform ${isTarget ? 'scale-110' : 'opacity-80'}`}>
                            <Icons.Heart className={`w-8 h-8 ${isTarget ? 'text-red-500 animate-pulse' : 'text-red-800'} filter drop-shadow-lg`} />
                            <span className={`text-4xl font-black font-mono leading-none tracking-tighter ${isTarget ? 'text-red-100' : 'text-red-900/80'} drop-shadow-md`}>
                                {monster.hp}
                            </span>
                        </div>

                        <div className={`absolute -bottom-1 -right-1 rounded-tl-lg px-2 py-0.5 border-t border-l border-slate-700/50 flex items-center gap-1 shadow-md bg-slate-900/90`}>
                             <span className="text-[10px] text-amber-500">â˜¯ï¸</span>
                            <span className={`text-sm font-black leading-none text-amber-300 font-mono`}>
                                {(monster.coins2 * 2 + monster.coins1)}
                            </span>
                        </div>
                    </div>

                    <div className="border-t border-slate-800/80 bg-slate-900/90 flex h-[32px] items-center px-1 overflow-hidden relative">
                         <div className="flex flex-wrap justify-start -space-x-1.5 w-full">
                            {monster.coins2 > 0 && Array.from({length: monster.coins2}).map((_, i) => (
                                <CoinIcon key={`2-${i}`} value={2} className="transform scale-[0.65] origin-left" />
                            ))}
                            {monster.coins1 > 0 && Array.from({length: monster.coins1}).map((_, i) => (
                                <CoinIcon key={`1-${i}`} value={1} className="transform scale-[0.65] origin-left" />
                            ))}
                        </div>
                    </div>
                </div>
            );
        };

        const PlayerCard = ({ speed, onClick, disabled, selected }) => {
            const config = getCardConfig(speed);
            return (
                <button onClick={onClick} disabled={disabled} className={`w-16 h-24 flex-shrink-0 rounded-lg border-2 relative transition-all duration-150 card-active overflow-hidden shadow-lg ${config.color} ${config.border} ${config.text} ${selected ? 'ring-2 ring-purple-400 -translate-y-3 shadow-purple-900/50' : ''} ${disabled ? 'opacity-30 grayscale cursor-not-allowed' : 'hover:-translate-y-1'}`}>
                    <div className="absolute top-1 left-1 flex flex-col items-center leading-none z-10 opacity-70"><span className="text-[8px]">SPD</span><span className="text-sm font-black font-mono">{speed}</span></div>
                    <div className="absolute inset-0 flex flex-col items-center justify-center pointer-events-none"><div className="text-4xl mb-1 drop-shadow-md filter contrast-125 transform hover:scale-110 transition-transform">{config.emoji}</div></div>
                    <div className="absolute bottom-0 inset-x-0 bg-black/50 py-1 flex justify-center items-center gap-1 border-t border-white/10 z-10"><span className="text-[9px]">å¨åŠ›</span><span className="text-sm font-bold font-mono">{config.power}</span></div>
                    <div className="absolute top-1 right-1 text-[10px] font-bold tracking-tighter writing-vertical-rl font-serif bg-black/30 px-0.5 py-1 rounded-sm">{config.name}</div>
                </button>
            );
        };

        const EnhancementControls = ({ player, bet, setBet }) => {
            if (!player) return null;
            const handleBetChange = (type, delta) => {
                const currentBetVal = type === 1 ? bet.coins1 : bet.coins2;
                const playerMax = type === 1 ? player.coins1 : player.coins2;
                const newVal = currentBetVal + delta;
                if (newVal >= 0 && newVal <= playerMax) setBet(prev => ({ ...prev, [type === 1 ? 'coins1' : 'coins2']: newVal }));
            };
            const bonusPower = bet.coins1 * 1 + bet.coins2 * 2; 
            const burnCost = bonusPower;

            return (
                <div className="bg-slate-900/95 p-2 rounded-t-lg border-t border-x border-slate-700 flex items-center justify-between w-full max-w-sm mx-auto mb-2 shadow-lg backdrop-blur-md">
                    <div className="text-[10px] font-bold text-slate-300 mr-2 flex flex-col items-center leading-tight font-serif"><span>ç‡ƒç‡’</span><span>ä¿®ç‚º</span></div>
                    <div className="flex gap-3">
                        <div className="flex items-center gap-1 bg-black/40 rounded px-1 py-0.5 border border-slate-700">
                            <button onClick={() => handleBetChange(2, -1)} className="w-6 h-6 flex items-center justify-center bg-slate-700 rounded text-white hover:bg-slate-600 disabled:opacity-30" disabled={bet.coins2 <= 0}><Icons.Minus /></button>
                            <div className="flex flex-col items-center justify-center w-8"><CoinIcon value={2} className="" /></div>
                            <button onClick={() => handleBetChange(2, 1)} className="w-6 h-6 flex items-center justify-center bg-slate-700 rounded text-white hover:bg-slate-600 disabled:opacity-30" disabled={bet.coins2 >= player.coins2}><Icons.Plus /></button>
                        </div>
                        <div className="flex items-center gap-1 bg-black/40 rounded px-1 py-0.5 border border-slate-700">
                            <button onClick={() => handleBetChange(1, -1)} className="w-6 h-6 flex items-center justify-center bg-slate-700 rounded text-white hover:bg-slate-600 disabled:opacity-30" disabled={bet.coins1 <= 0}><Icons.Minus /></button>
                            <div className="flex flex-col items-center justify-center w-8"><CoinIcon value={1} className="" /></div>
                            <button onClick={() => handleBetChange(1, 1)} className="w-6 h-6 flex items-center justify-center bg-slate-700 rounded text-white hover:bg-slate-600 disabled:opacity-30" disabled={bet.coins1 >= player.coins1}><Icons.Plus /></button>
                        </div>
                    </div>
                    <div className="ml-3 flex flex-col items-end">
                        <div className="flex items-center text-red-400 font-black text-base bg-red-950/30 px-2 py-0.5 rounded-t border-t border-x border-red-800/50">
                            <Icons.Fire className="w-4 h-4 mr-1" /> 
                            <span>+{bonusPower} å¨åŠ›</span>
                        </div>
                        <div className="text-[9px] text-slate-400 bg-slate-800/80 px-2 rounded-b border-b border-x border-slate-700 w-full text-center">
                            èŠ±è²» {burnCost} å¹´ä¿®ç‚º
                        </div>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [players, setPlayers] = useState([]);
            const [monsters, setMonsters] = useState([]);
            const [round, setRound] = useState(1);
            const [logs, setLogs] = useState([]);
            const [gameState, setGameState] = useState('init'); 
            const [showLogs, setShowLogs] = useState(true);
            const [showRules, setShowRules] = useState(false);
            const [showEndModal, setShowEndModal] = useState(false); 
            const [currentBet, setCurrentBet] = useState({ coins1: 0, coins2: 0 }); 
            const logsEndRef = useRef(null);

            useEffect(() => { initGame(); }, []);
            useEffect(() => { 
                if(showLogs) {
                    requestAnimationFrame(() => {
                        logsEndRef.current?.scrollIntoView({ behavior: "smooth" });
                    });
                }
            }, [logs, showLogs]);

            const initGame = () => {
                setShowEndModal(false);
                const newPlayers = Array.from({ length: PLAYER_COUNT }).map((_, i) => {
                    return {
                        id: i, 
                        name: i === 0 ? "æœ¬åº§" : PLAYER_NAMES[i - 1], 
                        isAI: i !== 0,
                        hand: Array.from({ length: MAX_CARDS }, (_, k) => k + 1),
                        usedCards: [],
                        coins1: INITIAL_COINS1, 
                        coins2: INITIAL_COINS2,
                        curseCount: 0, 
                        lastPlayed: null, 
                        lastBetPower: 0
                    };
                });
                
                let newMonsters = Array.from({ length: MONSTER_COUNT }).map((_, i) => {
                    const hp = Math.floor(Math.random() * 10) + 10; 
                    let coins2, coins1, totalValue;
                    do {
                        coins2 = Math.floor(Math.random() * 5) + 1;
                        coins1 = Math.floor(Math.random() * 5) + 2; 
                        totalValue = (coins2 * 2) + coins1;
                    } while (totalValue < 7 || totalValue > 13);
                    
                    return { id: i + 1, hp: hp, maxHp: hp, coins2: coins2, coins1: coins1, name: generateMonsterName(), bg: getRandomBg() };
                });
                
                setPlayers(newPlayers); 
                setMonsters(newMonsters); 
                setRound(1);
                setLogs([{text: "çµé­”äººé›†çµï¼è«¸ä½é“å‹è«‹å„é¡¯ç¥é€šã€‚", type: 'title', id: Date.now()}]);
                setGameState('selection'); 
                setCurrentBet({ coins1: 0, coins2: 0 });
            };

            const handleCardSelect = (speed) => {
                if (gameState !== 'selection') return;
                const nextPlayers = [...players];
                const p0 = nextPlayers[0];
                
                if (p0.usedCards.includes(speed)) return;

                p0.lastPlayed = speed;
                p0.usedCards.push(speed); 
                p0.coins1 -= currentBet.coins1; p0.coins2 -= currentBet.coins2;
                p0.lastBetPower = currentBet.coins1 * 1 + currentBet.coins2 * 2;
                setCurrentBet({ coins1: 0, coins2: 0 });

                for(let i=1; i<PLAYER_COUNT; i++){
                    const ai = nextPlayers[i];
                    const availableCards = ai.hand.filter(c => !ai.usedCards.includes(c));

                    if (availableCards.length === 0) {
                        ai.lastPlayed = null;
                        ai.lastBetPower = 0;
                        continue; 
                    }

                    const rIdx = Math.floor(Math.random() * availableCards.length);
                    ai.lastPlayed = availableCards[rIdx]; 
                    ai.usedCards.push(ai.lastPlayed); 
                    
                    let bet1 = 0; 
                    let bet2 = 0;
                    if (Math.random() < 0.3) {
                        if (ai.coins2 > 0 && Math.random() < 0.5) bet2 = 1;
                        else if (ai.coins1 > 0) bet1 = 1;
                    }
                    ai.coins1 -= bet1; ai.coins2 -= bet2;
                    ai.lastBetPower = bet1 * 1 + bet2 * 2; 
                }

                setPlayers(nextPlayers); 
                setGameState('resolving'); 
                setTimeout(() => resolveRound(nextPlayers), 1500); 
            };

            const resolveRound = (currentPlayers) => {
                let moves = currentPlayers.filter(p => p.lastPlayed !== null).map(p => {
                    const config = getCardConfig(p.lastPlayed);
                    const burnText = p.lastBetPower > 0 ? `(ğŸ”¥ç‡ƒä¿®ç‚º+${p.lastBetPower})` : '';
                    return { ...p, speed: p.lastPlayed, power: config.power + p.lastBetPower, basePower: config.power, emoji: config.emoji, cardName: config.name, burnText };
                }).sort((a,b) => a.speed - b.speed);
                
                let groups = {}; 
                moves.forEach(m => { 
                    if(!groups[m.speed]) groups[m.speed] = []; 
                    groups[m.speed].push(m); 
                });
                
                let currentMonsters = [...monsters];
                let tempPlayers = JSON.parse(JSON.stringify(currentPlayers)); 
                let roundLog = [];
                let logIdCounter = Date.now();
                
                let monsterHitHistory = {};

                roundLog.push({text: `--- ç¬¬ ${round} å›åˆé¬¥æ³• ---`, type: 'title', id: logIdCounter++});

                Object.keys(groups).sort((a,b)=>a-b).forEach(speed => {
                    if(currentMonsters.length === 0) return; 

                    const attackers = groups[speed];
                    const totalDmg = attackers.reduce((sum, a) => sum + a.power, 0);
                    const emoji = attackers[0].emoji;
                    const cardName = attackers[0].cardName;
                    const attackersNames = attackers.map(a => `${a.name}${a.burnText}`).join(', ');
                    
                    roundLog.push({ text: `âš¡ï¸[SPD ${speed}] ç¥­å‡ºã€${cardName}${emoji}ã€‘ ${attackersNames} â¡ï¸ è½Ÿå‡º ${totalDmg} å‚·å®³`, type: 'highlight', id: logIdCounter++ });

                    let dmgRemaining = totalDmg;
                    while(dmgRemaining > 0 && currentMonsters.length > 0) {
                        let target = currentMonsters[0];
                        
                        if (!monsterHitHistory[target.id]) monsterHitHistory[target.id] = [];
                        attackers.forEach(atk => {
                             monsterHitHistory[target.id].push({ playerId: atk.id, speed: parseInt(speed) });
                        });

                        if(dmgRemaining >= target.hp) {
                            let overkill = dmgRemaining - target.hp;
                            roundLog.push({text: `ğŸ’¥ ${target.name} è¢«è½Ÿæ®ºè‡³æ¸£ï¼`, type: 'kill', id: logIdCounter++});
                            
                            const coins2Share = Math.floor(target.coins2 / attackers.length);
                            const coins2Rem = target.coins2 % attackers.length;
                            const coins1Share = Math.floor(target.coins1 / attackers.length);
                            const coins1Rem = target.coins1 % attackers.length;
                            
                            attackers.forEach(atk => {
                                let p = tempPlayers.find(tp => tp.id === atk.id);
                                p.coins2 += coins2Share; 
                                p.coins1 += coins1Share;
                            });
                            
                            if(coins2Share || coins1Share) {
                                const totalGain = coins2Share * 2 + coins1Share;
                                roundLog.push({text: `ğŸ©¸ ç…‰åŒ–å¦–ä¸¹ï¼ç²å¾— é«˜éšä¿®ç‚ºx${coins2Share} ä½éšä¿®ç‚ºx${coins1Share} (ä¿®ç‚º+${totalGain})`, type: 'normal', id: logIdCounter++});
                            }

                            currentMonsters.shift(); 
                            
                            if(currentMonsters.length > 0) {
                                currentMonsters[0].coins2 += coins2Rem; 
                                currentMonsters[0].coins1 += coins1Rem;
                                if(coins2Rem || coins1Rem) {
                                    roundLog.push({text: `â¡ï¸ æ®˜å­˜ä¿®ç‚º(é«˜x${coins2Rem}, ä½x${coins1Rem}) è½‰ç§»è‡³ ${currentMonsters[0].name}`, type: 'transfer', id: logIdCounter++});
                                }
                                dmgRemaining = overkill; 
                            } else {
                                dmgRemaining = 0; 
                            }
                        } else {
                            target.hp -= dmgRemaining;
                            roundLog.push({text: `ğŸ—¡ï¸ é‡å‰µ ${target.name} ${dmgRemaining} é» (å‰© HP ${target.hp})`, type: 'normal', id: logIdCounter++});
                            dmgRemaining = 0; 
                        }
                    }
                });

                currentMonsters.forEach(activeMonster => {
                    const hits = monsterHitHistory[activeMonster.id];
                    if (hits && hits.length > 0) {
                        roundLog.push({text: `ğŸ’€ ${activeMonster.name} ç‹‚æ€§å¤§ç™¼ï¼Œå±æ¯’çˆ†ç™¼ï¼`, type: 'curse-title', id: logIdCounter++});
                        
                        const maxSpeed = Math.max(...hits.map(h => h.speed));
                        const lastHitters = hits.filter(h => h.speed === maxSpeed);
                        const uniqueVictims = [...new Set(lastHitters.map(h => h.playerId))];

                        uniqueVictims.forEach(pid => {
                            let p = tempPlayers.find(tp => tp.id === pid);
                            p.curseCount += 1;
                            roundLog.push({text: `ğŸ¤¢ ${p.name} æ²¾æŸ“å±æ¯’ï¼é“å¿ƒä¸ç©© (å±æ¯’+1)`, type: 'curse', id: logIdCounter++});
                        });
                    }
                });

                setLogs(prev => [...prev, ...roundLog]); 
                setMonsters(currentMonsters); 
                setPlayers(tempPlayers); 

                if(round >= MAX_ROUNDS || currentMonsters.length === 0) { 
                    setGameState('gameover'); 
                    setShowLogs(true);
                    setShowEndModal(true);
                } else { 
                    setRound(prev => prev + 1); 
                    setGameState('selection'); 
                }
            };

            if (gameState === 'init') {
                return (
                    <div className="flex items-center justify-center h-screen text-purple-400 animate-pulse font-serif">
                        çµé­”äººé›†çµä¸­ï¼Œæº–å‚™æ‰å¦–...
                    </div>
                );
            }

            return (
                <div className="flex-1 flex flex-col h-full bg-slate-950 overflow-hidden relative">
                    {showRules && <RulesModal onClose={() => setShowRules(false)} />}
                    {showEndModal && <GameEndModal players={players} onRestart={initGame} onClose={() => setShowEndModal(false)} />}
                    
                    <PlayerStatusBoard players={players} />
                    <div className="bg-slate-900/50 px-3 py-2 border-b border-slate-800 flex justify-between items-center shadow-sm relative z-30">
                        <div className="flex items-center gap-3">
                            <h1 className="text-lg font-black text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-rose-400 tracking-widest shadow-black drop-shadow-sm font-serif">çµé­”äºº</h1>
                            <button 
                                onClick={() => setShowRules(true)} 
                                className="relative overflow-hidden group bg-gradient-to-r from-amber-600 to-amber-500 hover:from-amber-500 hover:to-amber-400 text-white px-4 py-1.5 rounded-lg shadow-[0_0_12px_rgba(245,158,11,0.4)] flex items-center gap-2 transition-all active:scale-95 text-xs font-black border border-amber-400/50 font-serif tracking-wide btn-shine" 
                                title="çµé­”äººå®ˆå‰‡"
                            >
                                <Icons.Book className="w-3.5 h-3.5" /> 
                                <span className="relative z-10">çµé­”äººå®ˆå‰‡</span>
                            </button>
                        </div>
                        <div className="flex items-center gap-2 text-xs font-bold text-slate-400 font-serif">
                            <span className="bg-black/30 px-2 py-1 rounded border border-slate-800 text-amber-400">Round {round} / {MAX_ROUNDS}</span>
                             {gameState === 'gameover' && <button onClick={initGame} className="bg-purple-700 hover:bg-purple-600 text-white px-2 py-1 rounded shadow flex items-center gap-1 animate-pulse"><Icons.Refresh /> <span className="hidden sm:inline">é‡æ–°é–‹å§‹</span></button>}
                        </div>
                    </div>
                    <div className="bg-gradient-to-b from-slate-900 to-black py-3 flex-shrink-0 relative border-b border-slate-800/50">
                        <div className="text-[11px] text-slate-400 mb-1 px-3 flex justify-between font-serif">
                            <span>çµç‰©<strong className="text-red-400">å¦–é­”</strong> (å‰© {monsters.length} éš»)</span>
                            <span className="text-purple-400 font-bold animate-pulse">âš  æ²’æ®ºæ­» = å±æ¯’æ”»å¿ƒ</span>
                        </div>
                        <div className="flex gap-2 overflow-x-auto hide-scrollbar px-3 items-center min-h-[175px] py-1">{monsters.length === 0 ? <div className="w-full text-center text-purple-500 italic text-sm py-8 font-serif">å¦–é­”å·²ç›¡æ•¸ç…‰åŒ–ï¼Œæº–å‚™é£›æ˜‡ï¼</div> : monsters.map((m, i) => <MonsterCard key={m.id} monster={m} isTarget={i===0} />)}</div>
                    </div>
                    <div className="flex-1 min-h-0 bg-black/40 flex flex-col relative">
                        <div className="bg-slate-900/80 backdrop-blur px-3 py-1 text-[10px] text-slate-400 flex justify-between items-center cursor-pointer border-b border-slate-800/50 font-serif" onClick={() => setShowLogs(!showLogs)}><span>çµé­”ç´€éŒ„</span>{showLogs ? <Icons.ChevronDown /> : <Icons.ChevronUp />}</div>
                        {showLogs && 
                            <div className="flex-1 overflow-y-auto p-3 text-[11px] font-mono space-y-1 custom-scrollbar bg-black/20">
                                {logs.map((log, index) => 
                                    <div 
                                        key={log.id || index} 
                                        className={`
                                            ${log.type === 'title' ? 'text-amber-500 font-bold mt-3 border-b border-slate-800 pb-1 text-sm font-serif' : ''} 
                                            ${log.type === 'highlight' ? 'text-cyan-300 mt-1' : ''} 
                                            ${log.type === 'kill' ? 'text-green-400 font-bold bg-green-950/20 px-1 rounded inline-block border border-green-900/30' : ''} 
                                            ${log.type === 'transfer' ? 'text-purple-400 italic' : ''} 
                                            ${log.type === 'curse-title' ? 'text-red-400 font-black text-xs mt-1 animate-pulse' : ''} 
                                            ${log.type === 'curse' ? 'text-purple-300 font-bold bg-purple-950/30 px-1 border border-purple-900/50 rounded' : ''} 
                                            ${log.type === 'normal' ? 'text-slate-400' : ''}
                                        `}>
                                            {log.text}
                                    </div>
                                )}
                                <div ref={logsEndRef} />
                            </div>
                        }
                    </div>
                    <div className="bg-slate-950 pt-2 pb-safe border-t border-slate-900/80 z-30 flex flex-col">
                        {gameState === 'selection' && players[0] && <EnhancementControls player={players[0]} bet={currentBet} setBet={setCurrentBet} />}
                        <div className="px-2 pb-2">
                            <div className="text-[11px] text-slate-400 mb-1 flex justify-between px-1 font-serif"><span>ç¥­å‡ºæ³•å¯¶</span>{gameState === 'resolving' && <span className="text-amber-500 animate-pulse">æ­£åœ¨çµç®—...</span>}</div>
                            <div className="flex gap-1.5 overflow-x-auto hide-scrollbar pb-1 px-1 min-h-[100px]">
                                {gameState === 'gameover' ? (
                                    <div className="w-full text-center py-4 text-slate-500 font-serif">
                                        è«‹æŸ¥çœ‹ä¿®ç‚ºæ¦œå–®
                                    </div>
                                ) : (
                                    players[0]?.hand.length === 0 ? (
                                        <div className="text-slate-600 w-full text-center py-4 text-xs font-serif">æ³•å¯¶å·²è€—ç›¡</div>
                                    ) : (
                                        players[0]?.hand.map(speed => 
                                            <PlayerCard 
                                                key={speed} 
                                                speed={speed} 
                                                disabled={gameState !== 'selection' || players[0].usedCards.includes(speed)} 
                                                onClick={() => handleCardSelect(speed)} 
                                            />
                                        )
                                    )
                                )}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
<script data-goatcounter="https://legaceegame.goatcounter.com/count"
        async src="//gc.zgo.at/count.js"></script>
</body>

</html>
